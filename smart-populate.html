<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéµ POPULA√á√ÉO INTELIGENTE - SEM DUPLICATAS</title>
    <script src="config.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            margin: 0;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: rgba(0,0,0,0.3);
            padding: 30px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }
        .status {
            background: rgba(0,0,0,0.5);
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            border-left: 4px solid #4CAF50;
        }
        .error {
            border-left-color: #f44336;
        }
        .warning {
            border-left-color: #ff9800;
        }
        .btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
            transition: all 0.3s;
        }
        .btn:hover {
            background: #45a049;
            transform: translateY(-2px);
        }
        .btn-danger {
            background: #f44336;
        }
        .btn-danger:hover {
            background: #da190b;
        }
        .btn-warning {
            background: #ff9800;
        }
        .btn-warning:hover {
            background: #e68900;
        }
        .progress {
            width: 100%;
            height: 20px;
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #45a049);
            width: 0%;
            transition: width 0.3s;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .stat-card {
            background: rgba(0,0,0,0.4);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #4CAF50;
        }
        .logs {
            background: rgba(0,0,0,0.7);
            padding: 15px;
            border-radius: 10px;
            font-family: monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéµ POPULA√á√ÉO INTELIGENTE - SEM DUPLICATAS</h1>
        <p>Sistema avan√ßado que previne duplicatas durante a popula√ß√£o de m√∫sicas</p>
        
        <div id="status-container">
            <div class="status">
                <strong>üìä Status:</strong> Sistema pronto para opera√ß√£o...
            </div>
        </div>

        <div class="progress">
            <div class="progress-bar" id="progress-bar"></div>
        </div>

        <div class="stats" id="stats">
            <div class="stat-card">
                <div class="stat-number" id="stat-total">0</div>
                <div>Total Processadas</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="stat-inserted">0</div>
                <div>Novas Inseridas</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="stat-duplicates">0</div>
                <div>Duplicatas Evitadas</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="stat-errors">0</div>
                <div>Erros</div>
            </div>
        </div>

        <div style="text-align: center; margin: 30px 0;">
            <button class="btn" onclick="smartPopulate()">
                üß† POPULA√á√ÉO INTELIGENTE
            </button>
            <button class="btn btn-warning" onclick="cleanDuplicates()">
                üßπ LIMPAR DUPLICATAS EXISTENTES
            </button>
            <button class="btn btn-danger" onclick="testConnection()">
                üß™ TESTAR CONEX√ÉO
            </button>
        </div>

        <div id="logs" class="logs">üöÄ Sistema de Popula√ß√£o Inteligente carregado...
Recursos dispon√≠veis:
- ‚úÖ Verifica√ß√£o de duplicatas por t√≠tulo + artista
- ‚úÖ Normaliza√ß√£o de strings (acentos, pontua√ß√£o)
- ‚úÖ Inser√ß√£o em lotes otimizada
- ‚úÖ Relat√≥rios detalhados de progresso
- ‚úÖ Limpeza de duplicatas existentes

Pronto para uso!
</div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>

    <!-- Sistema de Preven√ß√£o de Duplicatas -->
    <script src="prevent-duplicates.js"></script>

    <script>
        // Verifica√ß√£o de senha de acesso
        function checkAccess() {
            const password = prompt('üîê Digite a senha de administrador para acessar as funcionalidades de expans√£o do banco:');
            
            if (!password) {
                alert('‚ùå Acesso negado! Esta p√°gina ser√° fechada.');
                window.close();
                return false;
            }
            
            const correctPasswordHash = 'karaoke2024'; // Senha: karaoke2024
            if (password !== correctPasswordHash) {
                alert('‚ùå Senha incorreta! Acesso negado. Esta p√°gina ser√° fechada.');
                window.close();
                return false;
            }
            
            return true;
        }
        
        // Verificar acesso antes de continuar
        if (!checkAccess()) {
            throw new Error('Acesso negado');
        }
        
        // Configura√ß√£o do Firebase - usando configura√ß√µes centralizadas
        if (!window.firebaseConfig || !validateConfig(window.firebaseConfig)) {
            alert('‚ùå Configura√ß√µes do Firebase n√£o encontradas ou inv√°lidas!');
            throw new Error('Configura√ß√µes do Firebase necess√°rias n√£o encontradas');
        }

        // Inicializar Firebase
        firebase.initializeApp(window.firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        // Elementos da interface
        const statusContainer = document.getElementById('status-container');
        const progressBar = document.getElementById('progress-bar');
        const logs = document.getElementById('logs');
        const statTotal = document.getElementById('stat-total');
        const statInserted = document.getElementById('stat-inserted');
        const statDuplicates = document.getElementById('stat-duplicates');
        const statErrors = document.getElementById('stat-errors');

        // Fun√ß√µes de interface
        function addStatus(message, type = 'info') {
            const statusClass = type === 'error' ? 'status error' : 
                               type === 'warning' ? 'status warning' : 'status';
            statusContainer.innerHTML = `<div class="${statusClass}"><strong>üìä Status:</strong> ${message}</div>`;
        }

        function addLog(message) {
            const timestamp = new Date().toLocaleTimeString();
            logs.textContent += `[${timestamp}] ${message}\n`;
            logs.scrollTop = logs.scrollHeight;
        }

        function updateProgress(percent) {
            progressBar.style.width = `${percent}%`;
        }

        function updateStats(stats) {
            statTotal.textContent = stats.current || stats.total || 0;
            statInserted.textContent = stats.results?.inserted || 0;
            statDuplicates.textContent = stats.results?.duplicates || 0;
            statErrors.textContent = stats.results?.errors || 0;
        }

        // Autentica√ß√£o
        async function ensureAuth() {
            return new Promise((resolve, reject) => {
                const timeout = setTimeout(() => {
                    reject(new Error('Timeout na autentica√ß√£o'));
                }, 10000);

                auth.onAuthStateChanged(async (user) => {
                    clearTimeout(timeout);
                    if (user) {
                        resolve(user);
                    } else {
                        try {
                            await auth.signInAnonymously();
                            resolve(auth.currentUser);
                        } catch (error) {
                            reject(error);
                        }
                    }
                });
            });
        }

        // Carregar banco de dados local (mesmo do script.js)
        async function loadLocalMusicDatabase() {
            // Banco de dados completo de m√∫sicas (copiado do script.js)
            return [
                // Pop Nacional
                { title: 'Evid√™ncias', artist: 'Chit√£ozinho & Xoror√≥', genre: 'sertanejo', searchTerm: 'evidencias chitaozinho xororo karaoke playback' },
                { title: 'Ainda Bem', artist: 'Marisa Monte', genre: 'mpb', searchTerm: 'ainda bem marisa monte karaoke playback' },
                { title: 'Aquarela', artist: 'Toquinho', genre: 'mpb', searchTerm: 'aquarela toquinho karaoke playback' },
                { title: 'Asa Branca', artist: 'Luiz Gonzaga', genre: 'mpb', searchTerm: 'asa branca luiz gonzaga karaoke playback' },
                { title: 'Beijinho no Ombro', artist: 'Valesca Popozuda', genre: 'funk', searchTerm: 'beijinho ombro valesca popozuda karaoke' },
                { title: 'Bom Rapaz', artist: 'Fernando & Sorocaba', genre: 'sertanejo', searchTerm: 'bom rapaz fernando sorocaba karaoke playback' },
                { title: 'Camarote', artist: 'Os Bar√µes da Pisadinha', genre: 'funk', searchTerm: 'camarote baroes pisadinha karaoke playback' },
                { title: 'Deus Me Livre', artist: 'Ra√ßa Negra', genre: 'pagode', searchTerm: 'deus me livre raca negra karaoke playback' },
                { title: 'Eduardo e M√¥nica', artist: 'Legi√£o Urbana', genre: 'rock', searchTerm: 'eduardo monica legiao urbana karaoke playback' },
                
                // Sertanejo
                { title: 'Ai Se Eu Te Pego', artist: 'Michel Tel√≥', genre: 'sertanejo', searchTerm: 'ai se eu te pego michel telo karaoke playback' },
                { title: 'Balada', artist: 'Gusttavo Lima', genre: 'sertanejo', searchTerm: 'balada gusttavo lima karaoke playback' },
                { title: 'Casal Perfeito', artist: 'Henrique & Juliano', genre: 'sertanejo', searchTerm: 'casal perfeito henrique juliano karaoke playback' },
                { title: 'Flor e o Beija-Flor', artist: 'Henrique & Juliano', genre: 'sertanejo', searchTerm: 'flor beija flor henrique juliano karaoke playback' },
                { title: 'Infiel', artist: 'Mar√≠lia Mendon√ßa', genre: 'sertanejo', searchTerm: 'infiel marilia mendonca karaoke playback' },
                { title: 'Meu Pedacinho de Ch√£o', artist: 'Almir Sater', genre: 'sertanejo', searchTerm: 'meu pedacinho chao almir sater karaoke playback' },
                { title: 'Mod√£o Duido', artist: 'Michel Tel√≥', genre: 'sertanejo', searchTerm: 'modao duido michel telo karaoke playback' },
                { title: 'Sogr√£o Caprichou', artist: 'Matheus & Kauan', genre: 'sertanejo', searchTerm: 'sograo caprichou matheus kauan karaoke playback' },
                { title: 'Temporal de Amor', artist: 'L√©o Magalh√£es', genre: 'sertanejo', searchTerm: 'temporal amor leo magalhaes karaoke playback' },
                { title: 'Z√© da Reca√≠da', artist: 'Gusttavo Lima', genre: 'sertanejo', searchTerm: 'ze recaida gusttavo lima karaoke playback' },
                { title: 'Saudade', artist: 'Luan Santana', genre: 'sertanejo', searchTerm: 'saudade luan santana karaoke playback' },
                { title: 'Meteoro', artist: 'Luan Santana', genre: 'sertanejo', searchTerm: 'meteoro luan santana karaoke playback' },
                { title: 'Largado √†s Tra√ßas', artist: 'Z√© Neto & Cristiano', genre: 'sertanejo', searchTerm: 'largado tracas ze neto cristiano karaoke playback' },
                { title: 'Notifica√ß√£o Preferida', artist: 'Z√© Neto & Cristiano', genre: 'sertanejo', searchTerm: 'notificacao preferida ze neto cristiano karaoke playback' },
                { title: 'Jenifer', artist: 'Gabriel Diniz', genre: 'sertanejo', searchTerm: 'jenifer gabriel diniz karaoke playback' },
                
                // Rock Nacional
                { title: 'Ainda √â Cedo', artist: 'Legi√£o Urbana', genre: 'rock', searchTerm: 'ainda cedo legiao urbana karaoke playback' },
                { title: 'Bete Balan√ßo', artist: 'Bar√£o Vermelho', genre: 'rock', searchTerm: 'bete balanco barao vermelho karaoke playback' },
                { title: 'Certas Coisas', artist: 'Lulu Santos', genre: 'rock', searchTerm: 'certas coisas lulu santos karaoke playback' },
                { title: 'Faroeste Caboclo', artist: 'Legi√£o Urbana', genre: 'rock', searchTerm: 'faroeste caboclo legiao urbana karaoke playback' },
                { title: 'Pais e Filhos', artist: 'Legi√£o Urbana', genre: 'rock', searchTerm: 'pais filhos legiao urbana karaoke playback' },
                { title: 'Que Pa√≠s √â Este', artist: 'Legi√£o Urbana', genre: 'rock', searchTerm: 'que pais este legiao urbana karaoke playback' },
                { title: 'Tempo Perdido', artist: 'Legi√£o Urbana', genre: 'rock', searchTerm: 'tempo perdido legiao urbana karaoke playback' },
                { title: 'Toda Forma de Amor', artist: 'Lulu Santos', genre: 'rock', searchTerm: 'toda forma amor lulu santos karaoke playback' },
                { title: 'Vento no Litoral', artist: 'Legi√£o Urbana', genre: 'rock', searchTerm: 'vento litoral legiao urbana karaoke playback' },
                { title: 'Ser√°', artist: 'Legi√£o Urbana', genre: 'rock', searchTerm: 'sera legiao urbana karaoke playback' },
                { title: 'Ideologia', artist: 'Cazuza', genre: 'rock', searchTerm: 'ideologia cazuza karaoke playback' },
                { title: 'O Tempo N√£o Para', artist: 'Cazuza', genre: 'rock', searchTerm: 'tempo nao para cazuza karaoke playback' },
                { title: 'Exagerado', artist: 'Cazuza', genre: 'rock', searchTerm: 'exagerado cazuza karaoke playback' },
                { title: 'Cora√ß√£o de Estudante', artist: 'Milton Nascimento', genre: 'rock', searchTerm: 'coracao estudante milton nascimento karaoke playback' },
                { title: 'Pra N√£o Dizer Que N√£o Falei das Flores', artist: 'Geraldo Vandr√©', genre: 'rock', searchTerm: 'pra nao dizer nao falei flores geraldo vandre karaoke playback' },
                
                // MPB
                { title: '√Åguas de Mar√ßo', artist: 'Elis Regina', genre: 'mpb', searchTerm: 'aguas marco elis regina karaoke playback' },
                { title: 'Carinhoso', artist: 'Pixinguinha', genre: 'mpb', searchTerm: 'carinhoso pixinguinha karaoke playback' },
                { title: 'Garota de Ipanema', artist: 'Tom Jobim', genre: 'mpb', searchTerm: 'garota ipanema tom jobim karaoke playback' },
                { title: 'Mas Que Nada', artist: 'Jorge Ben Jor', genre: 'mpb', searchTerm: 'mas que nada jorge ben jor karaoke playback' },
                { title: 'O Que √â Que a Baiana Tem', artist: 'Dorival Caymmi', genre: 'mpb', searchTerm: 'que baiana tem dorival caymmi karaoke playback' },
                { title: 'Samba de Uma Nota S√≥', artist: 'Tom Jobim', genre: 'mpb', searchTerm: 'samba uma nota so tom jobim karaoke playback' },
                { title: 'Tarde em Itapu√£', artist: 'Toquinho', genre: 'mpb', searchTerm: 'tarde itapua toquinho karaoke playback' },
                { title: 'Wave', artist: 'Tom Jobim', genre: 'mpb', searchTerm: 'wave tom jobim karaoke playback' },
                { title: 'Corcovado', artist: 'Tom Jobim', genre: 'mpb', searchTerm: 'corcovado tom jobim karaoke playback' },
                { title: 'Desafinado', artist: 'Tom Jobim', genre: 'mpb', searchTerm: 'desafinado tom jobim karaoke playback' },
                { title: 'Chega de Saudade', artist: 'Tom Jobim', genre: 'mpb', searchTerm: 'chega saudade tom jobim karaoke playback' },
                { title: 'Constru√ß√£o', artist: 'Chico Buarque', genre: 'mpb', searchTerm: 'construcao chico buarque karaoke playback' },
                { title: 'Apesar de Voc√™', artist: 'Chico Buarque', genre: 'mpb', searchTerm: 'apesar voce chico buarque karaoke playback' },
                { title: 'C√°lice', artist: 'Chico Buarque', genre: 'mpb', searchTerm: 'calice chico buarque karaoke playback' },
                { title: 'Travessia', artist: 'Milton Nascimento', genre: 'mpb', searchTerm: 'travessia milton nascimento karaoke playback' },
                
                // Pagode
                { title: 'Deixa a Vida Me Levar', artist: 'Zeca Pagodinho', genre: 'pagode', searchTerm: 'deixa vida me levar zeca pagodinho karaoke playback' },
                { title: 'Insens√≠vel', artist: 'P√©ricles', genre: 'pagode', searchTerm: 'insensivel pericles karaoke playback' },
                { title: 'Jeito de Muleque', artist: 'Exaltasamba', genre: 'pagode', searchTerm: 'jeito muleque exaltasamba karaoke playback' },
                { title: 'Meu Lugar', artist: 'Arlindo Cruz', genre: 'pagode', searchTerm: 'meu lugar arlindo cruz karaoke playback' },
                { title: 'Papel de P√£o', artist: 'Luiz Carlos da Vila', genre: 'pagode', searchTerm: 'papel pao luiz carlos vila karaoke playback' },
                { title: 'Sorriso Maroto', artist: 'Sorriso Maroto', genre: 'pagode', searchTerm: 'sorriso maroto karaoke playback' },
                { title: 'Caraca, Eu T√¥ Apaixonado', artist: 'Thiaguinho', genre: 'pagode', searchTerm: 'caraca apaixonado thiaguinho karaoke playback' },
                { title: 'Vou Deixar', artist: 'Skank', genre: 'pagode', searchTerm: 'vou deixar skank karaoke playback' },
                { title: 'Amor de Chocolate', artist: 'Naldo', genre: 'pagode', searchTerm: 'amor chocolate naldo karaoke playback' },
                { title: 'Cora√ß√£o Radiante', artist: 'Grupo Revela√ß√£o', genre: 'pagode', searchTerm: 'coracao radiante grupo revelacao karaoke playback' },
                { title: 'Pagode em Bras√≠lia', artist: 'Grupo Fundo de Quintal', genre: 'pagode', searchTerm: 'pagode brasilia fundo quintal karaoke playback' },
                { title: 'Coisinha do Pai', artist: 'Jorge Arag√£o', genre: 'pagode', searchTerm: 'coisinha pai jorge aragao karaoke playback' },
                { title: 'Identidade', artist: 'Jorge Arag√£o', genre: 'pagode', searchTerm: 'identidade jorge aragao karaoke playback' },
                { title: 'Malandro', artist: 'Bezerra da Silva', genre: 'pagode', searchTerm: 'malandro bezerra silva karaoke playback' },
                { title: 'Se Voc√™ Pensa', artist: 'Bezerra da Silva', genre: 'pagode', searchTerm: 'se voce pensa bezerra silva karaoke playback' },
                
                // Gospel
                { title: 'Ressuscita-me', artist: 'Aline Barros', genre: 'gospel', searchTerm: 'ressuscita me aline barros karaoke playback' },
                { title: 'Brasa Viva', artist: 'Fernandinho', genre: 'gospel', searchTerm: 'brasa viva fernandinho karaoke playback' },
                { title: 'Deus Cuida de Mim', artist: 'Kleber Lucas', genre: 'gospel', searchTerm: 'deus cuida mim kleber lucas karaoke playback' },
                { title: 'Eu Navegarei', artist: 'Gabriela Rocha', genre: 'gospel', searchTerm: 'eu navegarei gabriela rocha karaoke playback' },
                { title: 'Fiel √© o Senhor', artist: 'Thalles Roberto', genre: 'gospel', searchTerm: 'fiel senhor thalles roberto karaoke playback' },
                { title: 'Grande √© o Senhor', artist: 'Cassiane', genre: 'gospel', searchTerm: 'grande senhor cassiane karaoke playback' },
                { title: 'Hosana', artist: 'Gabriela Rocha', genre: 'gospel', searchTerm: 'hosana gabriela rocha karaoke playback' },
                { title: 'Isa√≠as 40', artist: 'Fernandinho', genre: 'gospel', searchTerm: 'isaias 40 fernandinho karaoke playback' },
                { title: 'Jesus em Tua Presen√ßa', artist: 'Diante do Trono', genre: 'gospel', searchTerm: 'jesus tua presenca diante trono karaoke playback' },
                { title: 'Koinonya', artist: 'Aline Barros', genre: 'gospel', searchTerm: 'koinonya aline barros karaoke playback' },
                { title: 'Tua Gra√ßa Me Basta', artist: 'Fernandinho', genre: 'gospel', searchTerm: 'tua graca me basta fernandinho karaoke playback' },
                { title: 'Uma Nova Hist√≥ria', artist: 'Fernandinho', genre: 'gospel', searchTerm: 'uma nova historia fernandinho karaoke playback' },
                { title: 'Vem, Esta √© a Hora', artist: 'Fernandinho', genre: 'gospel', searchTerm: 'vem esta hora fernandinho karaoke playback' },
                { title: 'Yeshua', artist: 'Fernandinho', genre: 'gospel', searchTerm: 'yeshua fernandinho karaoke playback' },
                { title: 'Lugar Secreto', artist: 'Gabriela Rocha', genre: 'gospel', searchTerm: 'lugar secreto gabriela rocha karaoke playback' },
                
                // Funk
                { title: 'Baile de Favela', artist: 'MC Jo√£o', genre: 'funk', searchTerm: 'baile favela mc joao karaoke playback' },
                { title: 'Bum Bum Tam Tam', artist: 'MC Fioti', genre: 'funk', searchTerm: 'bum bum tam tam mc fioti karaoke playback' },
                { title: 'Cr√©u', artist: 'MC Cr√©u', genre: 'funk', searchTerm: 'creu mc creu karaoke playback' },
                { title: 'Dan√ßa do Cr√©u', artist: 'MC Cr√©u', genre: 'funk', searchTerm: 'danca creu mc creu karaoke playback' },
                { title: 'Envolvimento', artist: 'MC Loma', genre: 'funk', searchTerm: 'envolvimento mc loma karaoke playback' },
                { title: 'Lepo Lepo', artist: 'Psirico', genre: 'funk', searchTerm: 'lepo lepo psirico karaoke playback' },
                { title: 'Olha a Explos√£o', artist: 'MC Kevinho', genre: 'funk', searchTerm: 'olha explosao mc kevinho karaoke playback' },
                { title: 'Paradinha', artist: 'Anitta', genre: 'funk', searchTerm: 'paradinha anitta karaoke playback' },
                { title: 'Vai Malandra', artist: 'Anitta', genre: 'funk', searchTerm: 'vai malandra anitta karaoke playback' },
                { title: 'Sua Cara', artist: 'Anitta', genre: 'funk', searchTerm: 'sua cara anitta karaoke playback' },
                
                // Internacional
                { title: 'Bohemian Rhapsody', artist: 'Queen', genre: 'internacional', searchTerm: 'bohemian rhapsody queen karaoke playback' },
                { title: 'Don\'t Stop Believin\'', artist: 'Journey', genre: 'internacional', searchTerm: 'dont stop believin journey karaoke playback' },
                { title: 'Hotel California', artist: 'Eagles', genre: 'internacional', searchTerm: 'hotel california eagles karaoke playback' },
                { title: 'Imagine', artist: 'John Lennon', genre: 'internacional', searchTerm: 'imagine john lennon karaoke playback' },
                { title: 'Let It Be', artist: 'The Beatles', genre: 'internacional', searchTerm: 'let it be beatles karaoke playback' },
                { title: 'My Way', artist: 'Frank Sinatra', genre: 'internacional', searchTerm: 'my way frank sinatra karaoke playback' },
                { title: 'Sweet Child O\' Mine', artist: 'Guns N\' Roses', genre: 'internacional', searchTerm: 'sweet child mine guns roses karaoke playback' },
                { title: 'Yesterday', artist: 'The Beatles', genre: 'internacional', searchTerm: 'yesterday beatles karaoke playback' },
                { title: 'Wonderwall', artist: 'Oasis', genre: 'internacional', searchTerm: 'wonderwall oasis karaoke playback' },
                { title: 'Shape of You', artist: 'Ed Sheeran', genre: 'internacional', searchTerm: 'shape of you ed sheeran karaoke playback' },
                { title: 'Perfect', artist: 'Ed Sheeran', genre: 'internacional', searchTerm: 'perfect ed sheeran karaoke playback' },
                { title: 'Thinking Out Loud', artist: 'Ed Sheeran', genre: 'internacional', searchTerm: 'thinking out loud ed sheeran karaoke playback' },
                { title: 'Someone Like You', artist: 'Adele', genre: 'internacional', searchTerm: 'someone like you adele karaoke playback' },
                { title: 'Hello', artist: 'Adele', genre: 'internacional', searchTerm: 'hello adele karaoke playback' },
                { title: 'Rolling in the Deep', artist: 'Adele', genre: 'internacional', searchTerm: 'rolling deep adele karaoke playback' },
                { title: 'Despacito', artist: 'Luis Fonsi', genre: 'internacional', searchTerm: 'despacito luis fonsi karaoke playback' },
                { title: 'La Vida Es Una Fiesta', artist: 'Manu Chao', genre: 'internacional', searchTerm: 'la vida fiesta manu chao karaoke playback' },
                { title: 'Havana', artist: 'Camila Cabello', genre: 'internacional', searchTerm: 'havana camila cabello karaoke playback' },
                { title: 'Senorita', artist: 'Shawn Mendes', genre: 'internacional', searchTerm: 'senorita shawn mendes karaoke playback' },
                { title: 'Blinding Lights', artist: 'The Weeknd', genre: 'internacional', searchTerm: 'blinding lights weeknd karaoke playback' }
            ];
        }

        // Popula√ß√£o inteligente
        async function smartPopulate() {
            addStatus('üß† Iniciando popula√ß√£o inteligente...', 'info');
            addLog('üß† POPULA√á√ÉO INTELIGENTE INICIADA');
            updateProgress(0);
            updateStats({ current: 0, results: { inserted: 0, duplicates: 0, errors: 0 } });

            try {
                await ensureAuth();
                addLog('‚úÖ Autentica√ß√£o realizada com sucesso');
                updateProgress(10);

                // Carregar m√∫sicas do banco local
                addLog('üìä Carregando banco de dados local...');
                const musicDatabase = await loadLocalMusicDatabase();
                updateProgress(20);

                if (!musicDatabase || !Array.isArray(musicDatabase)) {
                    throw new Error('Erro ao carregar banco de dados local');
                }

                addLog(`üìä Carregadas ${musicDatabase.length} m√∫sicas do banco local`);
                updateProgress(30);

                // Processar com verifica√ß√£o de duplicatas
                addLog('üîç Iniciando inser√ß√£o com verifica√ß√£o de duplicatas...');
                
                const results = await insertSongsWithDeduplication(db, musicDatabase, (progress) => {
                    const percent = 30 + (progress.current / progress.total) * 60;
                    updateProgress(percent);
                    updateStats(progress);
                    
                    if (progress.current % 10 === 0) {
                        addLog(`üìà Progresso: ${progress.current}/${progress.total} - Inseridas: ${progress.results.inserted}, Duplicatas: ${progress.results.duplicates}`);
                    }
                });

                updateProgress(100);
                updateStats({ current: results.total, results });

                addStatus('‚úÖ Popula√ß√£o inteligente conclu√≠da!', 'info');
                addLog('‚úÖ POPULA√á√ÉO INTELIGENTE FINALIZADA');
                addLog(`üìä Resultados finais:`);
                addLog(`   - Total processadas: ${results.total}`);
                addLog(`   - Novas inseridas: ${results.inserted}`);
                addLog(`   - Duplicatas evitadas: ${results.duplicates}`);
                addLog(`   - Erros: ${results.errors}`);
                addLog(`   - Ignoradas: ${results.skipped}`);

            } catch (error) {
                addStatus(`‚ùå Erro na popula√ß√£o: ${error.message}`, 'error');
                addLog(`‚ùå ERRO: ${error.message}`);
                console.error('Erro completo:', error);
            }
        }

        // Limpeza de duplicatas
        async function cleanDuplicates() {
            addStatus('üßπ Iniciando limpeza de duplicatas...', 'info');
            addLog('üßπ LIMPEZA DE DUPLICATAS INICIADA');
            updateProgress(0);

            try {
                await ensureAuth();
                addLog('‚úÖ Autentica√ß√£o realizada com sucesso');
                updateProgress(10);

                const results = await removeDuplicatesFromCollection(db, (progress) => {
                    const percent = 10 + (progress.current / progress.total) * 80;
                    updateProgress(percent);
                    
                    if (progress.current % 5 === 0) {
                        addLog(`üìà Progresso: ${progress.current}/${progress.total} duplicatas removidas`);
                    }
                });

                updateProgress(100);

                addStatus('‚úÖ Limpeza de duplicatas conclu√≠da!', 'info');
                addLog('‚úÖ LIMPEZA DE DUPLICATAS FINALIZADA');
                addLog(`üìä Resultados:`);
                addLog(`   - Duplicatas removidas: ${results.removed}`);
                addLog(`   - M√∫sicas mantidas: ${results.kept}`);

            } catch (error) {
                addStatus(`‚ùå Erro na limpeza: ${error.message}`, 'error');
                addLog(`‚ùå ERRO: ${error.message}`);
                console.error('Erro completo:', error);
            }
        }

        // Teste de conex√£o
        async function testConnection() {
            addStatus('üß™ Testando conex√£o...', 'info');
            addLog('üß™ TESTE DE CONEX√ÉO INICIADO');
            updateProgress(0);

            try {
                await ensureAuth();
                addLog('‚úÖ Autentica√ß√£o funcionando');
                updateProgress(25);

                // Testar escrita
                addLog('‚úçÔ∏è Testando escrita no Firebase...');
                const testRef = db.collection('debug_test');
                await testRef.add({
                    test: 'smart_populate_test',
                    timestamp: Date.now(),
                    status: 'success'
                });
                updateProgress(50);

                // Testar leitura
                addLog('üìñ Testando leitura do Firebase...');
                const snapshot = await testRef.limit(1).get();
                if (snapshot.empty) {
                    throw new Error('Falha na leitura');
                }
                updateProgress(75);

                // Verificar cole√ß√£o songs
                addLog('üîç Verificando cole√ß√£o songs...');
                const songsSnapshot = await db.collection('songs').limit(5).get();
                const songsCount = songsSnapshot.size;
                updateProgress(100);

                addStatus('‚úÖ Conex√£o funcionando perfeitamente!', 'info');
                addLog('‚úÖ TESTE DE CONEX√ÉO FINALIZADO');
                addLog(`üìä M√∫sicas na cole√ß√£o: ${songsCount} (amostra)`);

            } catch (error) {
                addStatus(`‚ùå Erro na conex√£o: ${error.message}`, 'error');
                addLog(`‚ùå ERRO: ${error.message}`);
            }
        }

        // Inicializa√ß√£o
        addLog('üöÄ Sistema carregado e pronto para uso!');
    </script>
</body>
</html>